import React, { useState, useEffect } from 'react';
import { 
  Target, 
  Megaphone, 
  Zap, 
  Sparkles, 
  Layers, 
  ArrowRight, 
  Check, 
  Loader2, 
  ShieldCheck, 
  TrendingUp, 
  Clock,
  RefreshCcw,
  CheckCircle2,
  Calendar,
  ArrowUpRight,
  PhoneCall
} from 'lucide-react';

// --- CONFIGURATION ---
const CALENDLY_LINK = "https://calendly.com/pbasu-ignite/"; 

const PILLARS = {
  "Clarity & Strategy": {
    id: "strategy",
    color: "blue",
    icon: <Target className="w-5 h-5" />,
    description: "Decision-making logic and brand-to-revenue alignment.",
    questions: [
      { id: "s1", label: "Strategic Decision Logic", options: [
        { text: "Manual/Intuition: I make moves based on gut feelings or messy data analysis.", score: 1 },
        { text: "AI-Assisted: I use tools like ChatGPT for brainstorming, but I still connect the dots manually.", score: 2 },
        { text: "System-Driven: AI monitors business data to generate research-backed strategic roadmaps.", score: 3 }
      ]},
      { id: "s2", label: "Expertise Storage", options: [
        { text: "Internal: My 10+ years of knowledge lives in my head; I am the primary bottleneck.", score: 1 },
        { text: "Static: Knowledge is in PDFs/SOPs that are rarely used or updated.", score: 2 },
        { text: "Knowledge Clone: My expertise is baked into AI systems that execute workflows for me.", score: 3 }
      ]},
      { id: "s3", label: "Offer Structure", options: [
        { text: "Custom Grind: Every client project is a unique, manual build from scratch.", score: 1 },
        { text: "Templated: I have standard packages, but delivery still requires heavy manual lift.", score: 2 },
        { text: "Productized Stack: Services are delivered through a high-margin, automated AI delivery stack.", score: 3 }
      ]}
    ],
    diagnosis: "You are operating as the 'Human Router' of your business strategy. Without you in the room, growth stalls because the logic is not yet systemized.",
    cta_focus: "Learn how to clone your strategic thinking into an AI-driven growth engine."
  },
  "Visibility & Content": {
    id: "visibility",
    color: "indigo",
    icon: <Megaphone className="w-5 h-5" />,
    description: "The efficiency of your authority-building systems.",
    questions: [
      { id: "v1", label: "Content Creation Workflow", options: [
        { text: "Manual Grind: I spend hours every week staring at a blank cursor in the drafts folder.", score: 1 },
        { text: "AI Drafting: I use AI for outlines, but repurposing and scheduling is still my job.", score: 2 },
        { text: "Content Factory: One raw asset is automatically turned into a month of omnichannel content.", score: 3 }
      ]},
      { id: "v2", label: "Platform Presence", options: [
        { text: "Siloed: I focus on one platform because I don't have time to manage others.", score: 1 },
        { text: "Manual Cross-Post: I copy and paste content across platforms, which is time-intensive.", score: 2 },
        { text: "Omnichannel System: Content is intelligently adapted for every platform without my input.", score: 3 }
      ]},
      { id: "v3", label: "Authority Measurement", options: [
        { text: "Vanity Metrics: I track likes and views but can't link them to revenue.", score: 1 },
        { text: "Lead Attribution: I know which posts bring leads, but the tracking is manual.", score: 2 },
        { text: "ROI Intelligence: Systems track the entire journey from post to payment automatically.", score: 3 }
      ]}
    ],
    diagnosis: "You are trading too much personal time for visibility. Your brand authority is scaling linearly with your effort, rather than exponentially with your systems.",
    cta_focus: "Discover how to build an automated content factory that builds authority while you sleep."
  },
  "Sales & Pipeline": {
    id: "sales",
    color: "fuchsia",
    icon: <Zap className="w-5 h-5" />,
    description: "The flow of prospects from lead to closed contract.",
    questions: [
      { id: "sa1", label: "Lead Qualification", options: [
        { text: "Manual Filter: I personally vet every inquiry, often wasting time on tire-kickers.", score: 1 },
        { text: "Static Forms: I use forms to collect data, but I still have to score them manually.", score: 2 },
        { text: "AI Concierge: An automated agent qualifies, scores, and books the right leads for me.", score: 3 }
      ]},
      { id: "sa2", label: "Follow-Up Cadence", options: [
        { text: "Reactive: I follow up when I remember or see a notification in my inbox.", score: 1 },
        { text: "Manual CRM: I use a CRM but have to set reminders and write emails manually.", score: 2 },
        { text: "Automated Nurture: Data-driven systems keep prospects warm until they are ready to buy.", score: 3 }
      ]},
      { id: "sa3", label: "Proposal Generation", options: [
        { text: "Blank Page: Every proposal takes 60-90 minutes of manual drafting.", score: 1 },
        { text: "Templates: I reuse sections but still spend significant time on 'customization'.", score: 2 },
        { text: "Dynamic Drafting: AI generates personalized, data-backed proposals in seconds.", score: 3 }
      ]}
    ],
    diagnosis: "Your sales pipeline has 'leaky bucket' syndrome. High-value leads are slipping through because the manual effort to nurture them is too high.",
    cta_focus: "Build a frictionless sales machine that qualifies and closes deals 24/7."
  },
  "Client Concierge": {
    id: "concierge",
    color: "amber",
    icon: <Sparkles className="w-5 h-5" />,
    description: "The onboarding and fulfillment experience.",
    questions: [
      { id: "c1", label: "Client Onboarding", options: [
        { text: "Chaotic: Onboarding is a series of manual emails and 'getting started' calls.", score: 1 },
        { text: "Checklist: I follow a standard list, but I still have to trigger every step.", score: 2 },
        { text: "Zero-Touch: Payment triggers project setup, portals, and info-gathering instantly.", score: 3 }
      ]},
      { id: "c2", label: "Support & Communication", options: [
        { text: "Personal Inbox: Clients email me directly for everything; I am their help desk.", score: 1 },
        { text: "Ticketing/FAQ: There is a system, but most questions still require a human reply.", score: 2 },
        { text: "AI Specialist: An AI agent handles 80% of routine client queries instantly.", score: 3 }
      ]},
      { id: "c3", label: "Success Tracking", options: [
        { text: "Reactive: I only know if a client is happy if they tell me (or don't complain).", score: 1 },
        { text: "Manual Updates: I send monthly reports that take me hours to put together.", score: 2 },
        { text: "Live Visibility: Clients have a 24/7 dashboard showing progress and ROI in real-time.", score: 3 }
      ]}
    ],
    diagnosis: "Your delivery model is high-friction. As you grow, the weight of client management will eventually break your ability to find new business.",
    cta_focus: "Unlock a 'White Glove' experience that doesn't require your constant presence."
  },
  "Ops & Admin": {
    id: "ops",
    color: "emerald",
    icon: <Layers className="w-5 h-5" />,
    description: "Internal efficiency and administrative automation.",
    questions: [
      { id: "o1", label: "Tool Connectivity", options: [
        { text: "Silos: My tools don't talk to each other; I am the human bridge for data.", score: 1 },
        { text: "Fragmented: Some tools are connected via Zapier, but there are constant gaps.", score: 2 },
        { text: "Unified Ecosystem: Data flows automatically from CRM to fulfillment to finance.", score: 3 }
      ]},
      { id: "o2", label: "Task Management", options: [
        { text: "Reactive: I start my day by answering whoever screamed loudest in my inbox.", score: 1 },
        { text: "To-Do List: I have a list, but it's disconnected from my team's actual work.", score: 2 },
        { text: "Systemized Workflow: Priorities are dynamically assigned based on real business goals.", score: 3 }
      ]},
      { id: "o3", label: "Knowledge Transfer", options: [
        { text: "Shadowing: New hires have to sit with me for weeks to learn how I do things.", score: 1 },
        { text: "Video Library: I have some recordings, but finding the right info is difficult.", score: 2 },
        { text: "Interactive SOPs: Systems guide team members through tasks with AI-powered support.", score: 3 }
      ]}
    ],
    diagnosis: "You are paying an 'Invisible Tax' of 10-15 hours a week on manual admin that should be handled by code, not your brain.",
    cta_focus: "Delete the admin tax and reclaim your highest-value hours."
  }
};

export default function App() {
  const [step, setStep] = useState('welcome');
  const [pillarIdx, setPillarIdx] = useState(0);
  const [questionIdx, setQuestionIdx] = useState(0);
  const [answers, setAnswers] = useState({});
  const [results, setResults] = useState(null);

  const pillarKeys = Object.keys(PILLARS);
  const currentPillarKey = pillarKeys[pillarIdx];
  const currentPillar = PILLARS[currentPillarKey];
  const currentQuestion = currentPillar.questions[questionIdx];

  const totalQuestions = 15;
  const currentProgressCount = Object.keys(answers).length;

  const handleAnswer = (opt) => {
    const newAnswers = { ...answers, [currentQuestion.id]: opt };
    setAnswers(newAnswers);

    if (questionIdx < currentPillar.questions.length - 1) {
      setQuestionIdx(v => v + 1);
    } else if (pillarIdx < pillarKeys.length - 1) {
      setPillarIdx(v => v + 1);
      setQuestionIdx(0);
    } else {
      calculateResults(newAnswers);
    }
  };

  const calculateResults = (finalAnswers) => {
    setStep('submitting');
    
    const scores = pillarKeys.map(key => {
      const pillarQuestions = PILLARS[key].questions;
      const pillarAnswers = pillarQuestions.map(q => finalAnswers[q.id]);
      const avg = pillarAnswers.reduce((sum, a) => sum + a.score, 0) / pillarAnswers.length;
      const friction = Math.round((1 - (avg / 3)) * 100);
      return { key, friction, label: key };
    });

    const biggest = scores.reduce((prev, curr) => (prev.friction > curr.friction) ? prev : curr);

    setTimeout(() => {
      setResults({ blocker: biggest.key, frictionScore: biggest.friction, all: scores });
      setStep('results');
    }, 2500);
  };

  return (
    <div className="min-h-screen bg-[#020617] text-slate-50 flex items-center justify-center p-4 sm:p-6 font-sans selection:bg-purple-500/30">
      {/* Background Decor */}
      <div className="fixed inset-0 overflow-hidden pointer-events-none">
        <div className="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-purple-900/10 blur-[120px] rounded-full" />
        <div className="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-blue-900/10 blur-[120px] rounded-full" />
      </div>

      <div className="relative w-full max-w-2xl z-10">
        
        {step === 'welcome' && (
          <div className="space-y-12 animate-in fade-in slide-in-from-bottom-4 duration-1000">
            <div className="text-center space-y-6">
              <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-purple-500/10 border border-purple-500/20 text-purple-400 text-xs font-bold uppercase tracking-widest">
                <ShieldCheck className="w-3.5 h-3.5" /> 2026 Strategic Intelligence
              </div>
              <h1 className="text-5xl md:text-7xl font-black tracking-tighter uppercase leading-[0.9] italic text-transparent bg-clip-text bg-gradient-to-b from-white to-slate-500">
                Business<br/>Efficiency Audit
              </h1>
              <p className="text-slate-400 text-lg md:text-xl max-w-md mx-auto font-medium leading-relaxed">
                Identify the manual <span className="text-white">"Ant Work"</span> bottlenecks preventing your next level of scale.
              </p>
            </div>
            
            <div className="flex flex-col gap-4">
              <button 
                onClick={() => setStep('questions')} 
                className="w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white py-6 rounded-3xl font-black uppercase tracking-widest active:scale-[0.98] transition-all flex items-center justify-center gap-3 shadow-2xl shadow-purple-600/20 group"
              >
                Launch Audit <ArrowRight className="w-5 h-5 group-hover:translate-x-1 transition-transform" />
              </button>
              
              <div className="flex justify-center gap-8 text-[10px] font-black uppercase tracking-[0.2em] text-slate-600">
                <div className="flex items-center gap-2"><Clock className="w-3 h-3" /> 15 Questions</div>
                <div className="flex items-center gap-2"><TrendingUp className="w-3 h-3" /> Growth Scan</div>
              </div>
            </div>
          </div>
        )}

        {step === 'questions' && (
          <div className="space-y-8 animate-in fade-in slide-in-from-right-4 duration-500">
            <div className="flex justify-between items-end mb-2">
              <div className="space-y-1">
                <div className="flex items-center gap-2 text-purple-400 font-black text-[10px] uppercase tracking-widest">
                  {currentPillar.icon}
                  <span>{currentPillarKey}</span>
                </div>
                <h3 className="text-slate-500 text-xs font-medium">{currentPillar.description}</h3>
              </div>
              <span className="text-[10px] font-black uppercase tracking-widest text-slate-600">
                Question {currentProgressCount + 1} / {totalQuestions}
              </span>
            </div>
            
            <div className="space-y-6">
              <div className="h-1.5 w-full bg-white/5 rounded-full overflow-hidden">
                <div 
                  className="h-full bg-gradient-to-r from-purple-500 to-blue-500 transition-all duration-700 ease-out" 
                  style={{ width: `${((currentProgressCount + 1) / totalQuestions) * 100}%` }} 
                />
              </div>
              <h2 className="text-2xl md:text-3xl font-bold leading-[1.1] tracking-tight text-white">{currentQuestion.label}</h2>
            </div>

            <div className="grid gap-3">
              {currentQuestion.options.map((opt, i) => (
                <button 
                  key={i} 
                  onClick={() => handleAnswer(opt)} 
                  className="w-full text-left p-6 bg-white/5 border border-white/5 rounded-[1.5rem] hover:border-purple-500/40 hover:bg-white/10 transition-all group flex items-start gap-5 relative overflow-hidden"
                >
                  <div className="w-6 h-6 rounded-full border-2 border-slate-800 mt-0.5 flex-shrink-0 group-hover:border-purple-500 transition-colors bg-slate-950 flex items-center justify-center">
                    <div className="w-2.5 h-2.5 rounded-full bg-purple-500 opacity-0 group-hover:opacity-100 transition-opacity shadow-[0_0_8px_rgba(168,85,247,0.8)]" />
                  </div>
                  <div className="text-slate-300 group-hover:text-white font-medium text-lg leading-snug">{opt.text}</div>
                </button>
              ))}
            </div>

            <div className="flex justify-between items-center pt-4">
               <button 
                onClick={() => {
                  if (questionIdx > 0) {
                    setQuestionIdx(questionIdx - 1);
                  } else if (pillarIdx > 0) {
                    const prevPillar = PILLARS[pillarKeys[pillarIdx - 1]];
                    setPillarIdx(pillarIdx - 1);
                    setQuestionIdx(prevPillar.questions.length - 1);
                  } else {
                    setStep('welcome');
                  }
                }}
                className="text-[10px] uppercase font-black text-slate-600 tracking-widest hover:text-white transition-colors flex items-center gap-2"
              >
                ← Back
              </button>
              <div className="text-[10px] uppercase font-black text-slate-700 tracking-[0.2em]">
                {Math.round(((currentProgressCount + 1) / totalQuestions) * 100)}% Complete
              </div>
            </div>
          </div>
        )}

        {step === 'submitting' && (
          <div className="text-center space-y-8 py-20 animate-in fade-in zoom-in duration-500">
            <div className="relative inline-block">
              <div className="absolute inset-0 bg-purple-500/20 blur-3xl rounded-full" />
              <Loader2 className="w-20 h-20 text-purple-500 animate-spin relative z-10 mx-auto" />
            </div>
            <div className="space-y-2">
              <div className="text-xl font-black uppercase tracking-[0.3em] text-white">Calculating Gaps</div>
              <div className="text-slate-500 text-sm font-medium">Measuring operational friction and scale-readiness...</div>
            </div>
          </div>
        )}

        {step === 'results' && (
          <div className="space-y-8 animate-in fade-in slide-in-from-bottom-8 duration-1000 pb-20">
            <div className="text-center space-y-3">
              <div className="inline-block px-4 py-1 rounded-full bg-emerald-500/10 text-emerald-400 text-[10px] font-black uppercase tracking-[0.2em] mb-2 border border-emerald-500/20">Audit Complete</div>
              <h2 className="text-4xl md:text-6xl font-black uppercase tracking-tighter italic leading-none bg-clip-text text-transparent bg-gradient-to-b from-white to-slate-500">
                Efficiency Gaps<br/>Diagnosed
              </h2>
            </div>

            <div className="bg-slate-900/60 backdrop-blur-xl border border-white/5 rounded-[2.5rem] p-8 md:p-12 space-y-10 shadow-2xl relative overflow-hidden group">
              <div className="absolute top-0 right-0 p-8 opacity-10 group-hover:opacity-20 transition-opacity">
                {PILLARS[results.blocker].icon}
              </div>
              
              <div className="flex flex-col md:flex-row md:items-end justify-between gap-6 relative z-10">
                <div className="space-y-2">
                  <span className="text-[10px] font-black uppercase tracking-[0.2em] text-slate-500">Critical Constraint</span>
                  <div className="text-3xl font-bold text-white uppercase tracking-tight">{results.blocker}</div>
                </div>
                <div className="text-right">
                  <div className="text-7xl font-black text-purple-500 leading-none tabular-nums tracking-tighter">{results.frictionScore}%</div>
                  <div className="text-[10px] font-black uppercase tracking-widest text-slate-500 mt-2">Manual Friction</div>
                </div>
              </div>
              
              <div className="space-y-6">
                <div className="h-3 w-full bg-slate-950 rounded-full overflow-hidden border border-white/5 p-0.5">
                  <div 
                    className="h-full bg-gradient-to-r from-purple-600 via-fuchsia-500 to-blue-500 transition-all duration-[2000ms] ease-out rounded-full shadow-[0_0_20px_rgba(168,85,247,0.4)]" 
                    style={{ width: `${results.frictionScore}%` }} 
                  />
                </div>
                <div className="space-y-4">
                  <p className="text-slate-200 leading-relaxed text-lg font-bold italic border-l-4 border-purple-500 pl-4 py-1">
                    "{PILLARS[results.blocker].diagnosis}"
                  </p>
                  <p className="text-slate-400 leading-relaxed text-sm font-medium">
                    {PILLARS[results.blocker].cta_focus}
                  </p>
                </div>
              </div>
            </div>

            {/* Results Comparison */}
            <div className="bg-slate-950 border border-white/5 rounded-[2rem] p-8 space-y-6">
              <p className="text-[10px] uppercase tracking-widest font-black text-slate-500 mb-2">Pillar Performance</p>
              <div className="grid gap-6">
                {results.all.map((p) => (
                  <div key={p.key} className="space-y-2">
                    <div className="flex justify-between text-[10px] font-black uppercase tracking-widest">
                      <span className="text-slate-400">{p.key}</span>
                      <span className={p.key === results.blocker ? "text-purple-400" : "text-slate-600"}>{p.friction}% Friction</span>
                    </div>
                    <div className="h-1 w-full bg-white/5 rounded-full overflow-hidden">
                      <div 
                        className={`h-full transition-all duration-1000 ${p.key === results.blocker ? "bg-purple-500" : "bg-slate-700"}`} 
                        style={{ width: `${p.friction}%` }} 
                      />
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* CTA Section */}
            <div className="bg-white text-black rounded-[2.5rem] p-8 md:p-12 space-y-8 shadow-2xl">
              <div className="flex items-center gap-3"><PhoneCall className="w-5 h-5 text-purple-600" /><h4 className="font-bold uppercase tracking-widest text-xs text-purple-600">Action Required</h4></div>
              
              <div className="space-y-4">
                <h3 className="text-3xl font-black uppercase tracking-tighter leading-none italic">Book Your Efficiency Audit</h3>
                <p className="text-slate-700 font-medium text-lg leading-snug">
                  We'll deep-dive into your <strong>{results.blocker}</strong> and build a custom architecture plan to remove you as the bottleneck.
                </p>
              </div>

              <div className="grid gap-4">
                {[
                  { title: "Identify ROI Gaps", desc: "Pinpoint where you're leaking money due to manual friction." },
                  { title: "System Architecture", desc: "We'll sketch out the exact tools and flows you need." },
                  { title: "AI Potential", desc: "Discover which 80% of your tasks can be handled by AI." }
                ].map((item, i) => (
                  <div key={i} className="flex gap-4 items-start group">
                    <div className="flex-shrink-0 w-6 h-6 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 mt-1">
                      <CheckCircle2 className="w-4 h-4" strokeWidth={3} />
                    </div> 
                    <div className="text-sm">
                      <span className="font-black uppercase tracking-tight block">{item.title}</span>
                      <span className="text-slate-500">{item.desc}</span>
                    </div>
                  </div>
                ))}
              </div>

              <a 
                href={CALENDLY_LINK} 
                target="_blank" 
                className="block w-full bg-black hover:bg-slate-800 text-white text-center py-6 rounded-2xl font-black uppercase tracking-widest transition-all shadow-xl active:scale-[0.98] no-underline text-lg flex items-center justify-center gap-3"
              >
                Schedule Consultancy Session <ArrowUpRight className="w-5 h-5" />
              </a>
              <p className="text-[10px] text-center text-slate-500 font-black uppercase tracking-widest">
                No-Pitch Strategic Audit • 30 Minutes
              </p>
            </div>
            
            <div className="text-center pt-8">
               <button 
                onClick={() => window.location.reload()} 
                className="inline-flex items-center gap-2 text-[10px] uppercase font-black text-slate-600 tracking-[0.4em] hover:text-white transition-colors py-4 group"
              >
                <RefreshCcw className="w-3 h-3 group-hover:rotate-180 transition-transform duration-500" /> 
                Start New Audit
              </button>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}